
@{
    Layout = null;
}



<html>
<head>
    <title>SBMWebInterface</title>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script src="~/Content/toggles/jquery/iphone-style-checkboxes.js"></script>
    <link rel="stylesheet" href="~/Content/toggles/style.css" />

    <style type="text/css">
        body {
            max-width: 100%;
            overflow-x: hidden;
        }

        .top {
            vertical-align: top;
            margin: 0;
            padding: 0;
        }

        td {
            padding-right: 50px;
        }

        table {
        }

        .time {
            font-family: courier, monospace;
            padding: 3%;
            color: white;
            font-size: 4em;
        }

        .navbar {
                    font-family: courier, monospace;
                    font-size: 2em;
                    color: white;
                    background: rgba(0,0,0,0.6);
                    padding-left: 5px;
                    padding-top: 5px;
                    height: 40px;
                    width: 100%;
                }

        body {
            margin: 0;
            padding: 0;
            background-color: #0099cc;
        }

                       
                    .slider {
                        padding: 10px;
                        margin-left: 3%;
                        width: 35%;
                    }

                    .control-title {
                        font-family: courier, monospace;
                        font-size: 1em;
                        margin-left: 3%;
                        margin-top: 3%;
                        color: white;
                    }

                    .bar {
                        padding: 10px;
                        margin-left: 3%;
                        width: 35%;
                    }

                    .position {
                        padding: 10px;
                        margin-left: 3%;
                        width: 100%;
                    }

                    .clock {
                        padding: 10px;
                        margin-left: 3%;
                        width: 100%;
                    }

                    .ac {
                        padding: 10px;
                        margin-left: 3%;
                        width: 60px;
                        text-align: center;
                    }

                    .sidebar {
                        margin-left: 40%;
                        width: 60%;
                    }

                    textarea {
                    resize: none;
                    min-width: 600px;
                    min-height: 100px;
                }

                .console-title {
                    font-family: courier, monospace;
                    font-size: 1em;
                    color: white;
                    padding-bottom: 10px;
                }

                table.nova {
                    padding: 0;
                    margin: 0;
                }

                    table.nova td {
                        padding: 0;
                        margin: 0;
                    }

             


    </style>

    <script type="text/javascript">
    

    $(function () {
       $("#sklopka").prop("checked", '@ViewBag.motorState' == 'True');
       // $("#sklopka").iphoneStyle("refresh");
     
    });
        $(function () {
            $("#dc").slider({
                value: '@ViewBag.motorSpeed',
            });
            $("#dc").click(function () {
                $.ajax({
                    //type: "POST",
                    //url: "/SBMWebInterface/ChangeMotorSpeed",
                    //data: { motorSpeed: $("#dc").slider("value") }
                });




            });
            $(function () {
                $("#dc").slider();

                var startPos = '$("#dc").slider("value");', endPos = '';

                $("#dc").on("slidestop", function (event, ui) {
                    endPos = ui.value;

                    if (startPos != endPos) {
                        $.ajax({
                            type: "POST",
                            url: "/SBMWebInterface/ChangeMotorSpeed",
                            data: { motorSpeed: $("#dc").slider("value") }
                        });
                    }

                    startPos = endpos;
                });
            });
        });

        $(function () {
            $("#bar").progressbar();
            $("#bar").progressbar("value", '@ViewBag.fuelLevel');
        });


        $(function () {
            $(".time span").text("@ViewBag.machineTime");
        });

    //$(function () {
    //    $(".save").button();

    //});

    $(function () {
        $(".clear").button();
        $(".clear").click(function () {
            $("#terminal").text("");
        });
    });

    $(function () {
        $("#terminal").append('@ViewBag.terminalText' + '\r\n');
    });
        
    //$(setInterval(function () {
    //        $.ajax({
    //            url: "/SBMWebInterface/GetTerminalData",
    //            datatype: "json",
    //            type: "GET",
    //            success: function (data) {
    //                if (data != null) {
    //                    $("#terminal").append(data + "\r\n");
    //                }
    //            }
    //        });
    //}, 100));
        
        $(function () {
            $("#enable").prop("checked", '@ViewBag.enable' == 'True');
        });

        $(function () {
            var notificationHub = $.connection.notificationHub;
       
            notificationHub.client.addNotification = function (notificationMessage) {
                $("#terminal").append(notificationMessage + "\r\n");
            }
        
            notificationHub.client.updateMotorState = function (value) {
                $("#sklopka").prop("checked", value == 'True');
                $("#sklopka").iphoneStyle("refresh");
            }

            notificationHub.client.updateEnableInterface = function (value) {
                $("#enable").prop("checked", value == 'True');
                $("#enable").iphoneStyle("refresh");
            }

            notificationHub.client.updateMotorSpeed = function (value) {
                $("#dc").slider("value", value);
            }

            notificationHub.client.updateFuelLevel = function (value) {    
                $("#bar").progressbar("value", value);
            }

            notificationHub.client.updateTime = function (value) {
                $(".time span").text(value);
            }

            $.connection.hub.start().done(function () {
                $("#sklopka").iphoneStyle({
                    onChange: function (elem, value) {
                        notificationHub.server.changeMotorState(value);
                    }
                });
                $("#enable").iphoneStyle({
                    onChange: function (elem, value) {
                        notificationHub.server.changeEnableInterface(value);
                    }
                });
            
               
                $("#bar").progressbar("value", parseInt(@ViewBag.fuelLevel));
            });
        });

        $(function () {
            $(".download").button();
            $(".download").click(function() {
                window.open("/Home/GetSimulator");
            });
        });
   </script>
</head>


<body>
    <div class="top">
            <div class="navbar">
                SBMWebInterface
    </div>
</div>

    <table>
        <tr>
            <td>
                <div class="control-title">Enable/Disable Web Interface</div>
                <div class="position"><input type="checkbox" id="enable"/></div>
                <div class="control-title">AC motor control</div>
                <div class="position"><input type="checkbox" id="sklopka"/></div>
                <div class="control-title">DC motor control</div>
                <div class="position">
                <div id="dc"></div>
                </div>
                <div class="control-title">Fuel monitor</div>
                <div class="position">
                    <div id="bar"></div>
                </div>
                <div class="control-title">
                    Real Time Clock
                </div>
                <div class="time">
                <span>Undefined</span>   
                </div>




                <div class="control-title">Console</div>
                <div class="position">
                    <textarea id="terminal" readonly></textarea>

                    <table class="nova">
                        <tr>
                            @*<td><div class="save">Save</div></td>*@
                            <td><div class="clear">Clear</div></td>
                        </tr>
                    </table>
                </div>
            </td>
            <td align="right" style="padding-bottom: 370px">
                <div class="control-title">To see how these works download Wifly Simulator.</div>   
                <br />
                <div class="download">Download Simulator</div>
            </td>
        </tr>
    </table>
</body>
</html>
